<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - <%= guildName %></title>
  <link rel="stylesheet" href="/static/css/admin-panel.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <% if (userAvatar) { %>
          <img src="<%= userAvatar %>" alt="Avatar" class="user-avatar">
        <% } %>
        <div class="user-info">
          <h1>Admin Panel</h1>
          <p class="guild-name"><%= guildName %></p>
        </div>
      </div>
      <div class="header-right">
        <span class="admin-badge">Admin: <%= userName %></span>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-row" id="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="stat-members">--</div>
        <div class="stat-label">Members</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-players">--</div>
        <div class="stat-label">Players Setup</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-wishlists">--</div>
        <div class="stat-label">Wishlists</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-parties">--</div>
        <div class="stat-label">Parties</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-rolls">--</div>
        <div class="stat-label">Active Rolls</div>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="parties">
        <span class="tab-icon">&#9876;</span>
        <span>Party Management</span>
      </button>
      <button class="tab-btn" data-tab="users">
        <span class="tab-icon">&#128101;</span>
        <span>User Management</span>
      </button>
      <button class="tab-btn" data-tab="reminders">
        <span class="tab-icon">&#128276;</span>
        <span>Reminders</span>
      </button>
      <button class="tab-btn" data-tab="wishlists">
        <span class="tab-icon">&#127873;</span>
        <span>Give Items</span>
      </button>
      <button class="tab-btn" data-tab="itemrolls">
        <span class="tab-icon">&#127922;</span>
        <span>Item Rolls</span>
      </button>
    </div>

    <!-- Party Management Tab -->
    <div id="tab-parties" class="tab-content active">
      <div class="card">
        <h2 class="card-title">Event Party Formation</h2>
        <p class="card-description">Form parties for upcoming events using the visual party editor.</p>
        <div id="events-list">
          <div class="loading">Loading events...</div>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">Static Parties</h2>
        <p class="card-description">View and edit permanent static party assignments.</p>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="openStaticPartyEditor()">
            Open Static Party Editor
          </button>
        </div>
      </div>
    </div>

    <!-- User Management Tab -->
    <div id="tab-users" class="tab-content">
      <div class="card">
        <h2 class="card-title">User Management</h2>
        <p class="card-description">Reset user wishlists or party information.</p>

        <div class="search-container">
          <input type="text" id="user-search" class="form-control" placeholder="Search members...">
        </div>

        <div class="members-list" id="members-list">
          <div class="loading">Loading members...</div>
        </div>
      </div>
    </div>

    <!-- Reminders Tab -->
    <div id="tab-reminders" class="tab-content">
      <div class="card">
        <h2 class="card-title">Party Info Reminder</h2>
        <p class="card-description">Send a DM reminder to all members who haven't set up their party information yet.</p>
        <div class="reminder-info">
          <p>This will send a reminder to members who:</p>
          <ul>
            <li>Haven't set up their weapons</li>
            <li>Don't have an excluded role</li>
          </ul>
        </div>
        <div class="action-buttons">
          <button class="btn btn-primary" id="btn-remind-party" onclick="sendPartyInfoReminder()">
            Send Party Info Reminders
          </button>
        </div>
        <div id="party-reminder-result" class="reminder-result"></div>
      </div>

      <div class="card">
        <h2 class="card-title">Wishlist Reminder</h2>
        <p class="card-description">Send a DM reminder to all members who haven't submitted their wishlist yet.</p>
        <div class="reminder-info">
          <p>This will send a reminder to members who:</p>
          <ul>
            <li>Haven't submitted a wishlist</li>
            <li>Don't have an excluded role</li>
          </ul>
        </div>
        <div class="action-buttons">
          <button class="btn btn-primary" id="btn-remind-wishlist" onclick="sendWishlistReminder()">
            Send Wishlist Reminders
          </button>
        </div>
        <div id="wishlist-reminder-result" class="reminder-result"></div>
      </div>
    </div>

    <!-- Give Items Tab -->
    <div id="tab-wishlists" class="tab-content">
      <div class="card">
        <h2 class="card-title">Distribute Wishlist Items</h2>
        <p class="card-description">Mark items as given to users from their wishlists.</p>

        <div class="search-container">
          <input type="text" id="wishlist-search" class="form-control" placeholder="Search users...">
        </div>

        <div class="wishlists-list" id="wishlists-list">
          <div class="loading">Loading wishlists...</div>
        </div>
      </div>
    </div>

    <!-- Item Rolls Tab -->
    <div id="tab-itemrolls" class="tab-content">
      <div class="card">
        <h2 class="card-title">Create Item Roll</h2>
        <p class="card-description">Create a new item roll for members to participate in.</p>

        <div class="form-group">
          <label>Select Category</label>
          <select id="roll-category" class="form-control" onchange="onRollCategoryChange()">
            <option value="">-- Select Category --</option>
          </select>
        </div>

        <div class="form-group" id="roll-subcategory-group" style="display: none;">
          <label>Select Subcategory</label>
          <select id="roll-subcategory" class="form-control" onchange="onRollSubcategoryChange()">
            <option value="">-- Select Subcategory --</option>
          </select>
        </div>

        <div class="form-group" id="roll-item-group" style="display: none;">
          <label>Select Item</label>
          <select id="roll-item" class="form-control" onchange="onRollItemChange()">
            <option value="">-- Select Item --</option>
          </select>
        </div>

        <div id="roll-item-preview" class="item-preview" style="display: none;">
          <img id="roll-item-image" src="" alt="Item">
          <div class="item-preview-info">
            <div id="roll-item-name" class="item-preview-name"></div>
          </div>
        </div>

        <div class="form-group">
          <label>Trait (optional)</label>
          <input type="text" id="roll-trait" class="form-control" placeholder="e.g., +12% Melee Attack">
        </div>

        <div class="form-group">
          <label>Duration (minutes)</label>
          <input type="number" id="roll-duration" class="form-control" value="60" min="1" max="1440">
        </div>

        <div class="form-group">
          <label>Channel to Post In</label>
          <select id="roll-channel" class="form-control">
            <option value="">-- Select Channel --</option>
          </select>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" id="btn-create-roll" onclick="createItemRoll()">
            Create Item Roll
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Confirmation Modal -->
  <div id="confirm-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 id="confirm-modal-title">Confirm Action</h2>
        <button class="modal-close" onclick="closeConfirmModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirm-modal-message"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
        <button class="btn btn-primary" id="confirm-modal-btn" onclick="confirmAction()">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Initialize Constants from Server -->
  <script>
    const TOKEN = '<%= token %>';
    const GUILD_ID = '<%= guildId %>';
  </script>

  <!-- Main Application Script -->
  <script src="/static/js/admin-panel.js"></script>
</body>
</html>
